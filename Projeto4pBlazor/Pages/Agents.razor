@page "/Agents"
@inject HttpClient Http
@inject UserSession UserSession
@using Projeto4pServer.DTOs
@inject NavigationManager NavigationManager

<main>
    <div class="flex flex-wrap justify-center bg-black text-white p-4 min-h-screen">
        @if (characters == null)
        {
            <p>Carregando agentes...</p>
        }
        else if (!characters.Any())
        {
            <p>Você ainda não criou nenhum agente, teste. Clique em "Criar Agente" para começar!</p>
        }
        else
        {
            @foreach (var character in characters)
            {
                <div class="bg-neutral-800 rounded-lg shadow-lg p-4 m-4 w-64 h-128 overflow-y-auto">
                    <h2 class="text-xl font-bold text-purple-400">@character.Name</h2>
                    <p><strong>Id do Usuário:</strong> @character.UserId</p>
                    <p><strong>Age:</strong> @character.CAT</p>
                </div>
            }
        }
    </div>
</main>

@code {
    private List<CharacterDto>? characters;
    private readonly Guid adminId = new Guid("01978a0f-8c46-7a95-a278-e19886de81a2");

    protected override async Task OnInitializedAsync()
    {
        try
        {
            if (UserSession.UserId == adminId)
            {
                // Se o usuário for o admin, busca todos os personagens
                characters = await Http.GetFromJsonAsync<List<CharacterDto>>("api/User/Character");
            }
            else if (UserSession.UserId != null)
            {
                // Busca apenas os personagens do usuário logado
                characters = await Http.GetFromJsonAsync<List<CharacterDto>>($"api/User/Character/{UserSession.UserId}");
            }
            else
            {
                // Se o usuário não estiver logado, redireciona para a página inicial
                NavigationManager.NavigateTo("/");        
                return;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching characters: {ex.Message}");
        }
    }
}